<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ â€“ Ù…Ø³ØªØ± Ø£Ø¨Ù„</title>
    <style>
        body {
            margin:0;
            font-family: Arial, sans-serif;
            background:#050505;
            color:#fff;
        }
        .top-bar {
            background:#000;
            padding:10px 20px;
            display:flex;
            align-items:center;
            justify-content:space-between;
        }
        .top-bar a { color:#aaa; text-decoration:none; }

        .page-wrap {
            max-width:900px;
            margin:30px auto;
            padding:0 20px;
        }
        table {
            width:100%;
            border-collapse: collapse;
            margin-top:15px;
        }
        th, td {
            border-bottom:1px solid #333;
            padding:8px;
            font-size:14px;
            text-align:center;
        }
        th {
            background:#111;
        }
        .empty {
            margin-top:30px;
            text-align:center;
            color:#aaa;
        }
        .total-box {
            text-align:left;
            margin-top:15px;
            font-size:18px;
        }
        .btn {
            display:inline-block;
            margin-top:15px;
            padding:10px 16px;
            border-radius:8px;
            border:none;
            cursor:pointer;
            font-size:14px;
        }
        .btn-clear {
            background:#333;
            color:#fff;
        }
        .btn-whatsapp {
            background:#25d366;
            color:#fff;
            text-decoration:none;
        }
    </style>
</head>
<body>

<header class="top-bar">
    <a href="index.html">
        <img src="images/logo.png" alt="logo" style="height:70px;">
    </a>
    <a href="index.html">Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ¬Ø±</a>
</header>

<div class="page-wrap">
    <h1>Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h1>

    <div id="cartContainer"></div>
</div>

<!-- Ø±Ø¨Ø· cart.js -->
<script src="cart.js"></script>

<script>
function renderCart() {
    const cart = getCart();
    const container = document.getElementById('cartContainer');

    if (cart.length === 0) {
        container.innerHTML = '<div class="empty">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸ›’</div>';
        return;
    }

    let total = 0;
    cart.forEach(item => {
        total += item.price * item.qty;
    });

    let rows = cart.map((item, index) => `
        <tr>
            <td>${index + 1}</td>
            <td>${item.name}</td>
            <td>${item.capacity || '-'}</td>
            <td>${item.color || '-'}</td>
            <td>${item.qty}</td>
            <td>${formatIQD(item.price)}</td>
            <td>${formatIQD(item.price * item.qty)}</td>
        </tr>
    `).join('');

    const table = `
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                    <th>Ø§Ù„Ø³Ø¹Ø©</th>
                    <th>Ø§Ù„Ù„ÙˆÙ†</th>
                    <th>Ø§Ù„Ø¹Ø¯Ø¯</th>
                    <th>Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙˆØ­Ø¯Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                </tr>
            </thead>
            <tbody>
                ${rows}
            </tbody>
        </table>
        <div class="total-box">
            Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: <strong>${formatIQD(total)}</strong>
        </div>
        <button class="btn btn-clear" onclick="handleClearCart()">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
        <a class="btn btn-whatsapp" href="${buildWhatsAppLink(cart, total)}" target="_blank">
            Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ ğŸ“±
        </a>
    `;

    container.innerHTML = table;
}

function handleClearCart() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ')) {
        clearCart();
        renderCart();
    }
}

function buildWhatsAppLink(cart, total) {
    let message = 'Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ù…ÙˆÙ‚Ø¹ Mr Apple:%0A%0A';
    cart.forEach((item, index) => {
        message += `${index+1}- ${item.name} | ${item.capacity || ''} | ${item.color || ''} | Ø¹Ø¯Ø¯: ${item.qty} | Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${formatIQD(item.price * item.qty)}%0A`;
    });
    message += `%0AØ§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: ${formatIQD(total)}%0A%0AØ§Ù„Ø±Ø¬Ø§Ø¡ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.`;

    // Ø¶Ø¹ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù‡Ù†Ø§
    const phone = '9647812349544';
    return `https://wa.me/${phone}?text=${message}`;
}

document.addEventListener('DOMContentLoaded', function() {
    renderCart();
    updateCartCountBadge();
});
</script>

</body>
</html>
